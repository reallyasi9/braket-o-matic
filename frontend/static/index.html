<!doctype html>
<html>
<head>
  <title>braket-o-matic</title>
  <meta name="viewport"
  content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

  <link rel="stylesheet" type="text/css"
  href="https://fonts.googleapis.com/css?family=Cantarell:400,700">
  <link rel="import"
  href="bower_components/google-signin/google-signin.html">

  <style>
html,body {
  height: 100%;
  margin: 0;
  background-color: #E5E5E5;
  font-family: 'RobotoDraft', sans-serif;
}
  </style>

</head>

<body unresolved>

  <google-signin client-id="955696707006-d65hn137t184mbjcohuosff7os1vumjp.apps.googleusercontent.com" scopes="https://www.googleapis.com/auth/userinfo.email"></google-signin>

  <!-- For kicks -->
  <dom-module id="user-card">
    <template>
      <div class="card">
        <h1>{{displayName}}</h1>
        <h2>Avatar <img src="{{image.url}}" /></h2>
      </div>
    </template>

    <script>
      Polymer({
        is: 'user-card',
        properties: {
          displayName: String,
          image: Object
        }
      });
    </script>
  </dom-module>

  <user-card></user-card>

  <script type="text/javascript">
  document.addEventListener("google-signin-success", function(e) {
    var cu = gapi.auth2.getAuthInstance().currentUser.get();

    // Authentication
    var it = cu.getAuthResponse().id_token;
    // TODO: post to backend, verify with Google. (https://developers.google.com/identity/sign-in/web/backend-auth)
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/backend/verify-user');
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onload = function() {
      console.log('Signed in as: ' + xhr.responseText);
    };
    xhr.send('id_token=' + it);

    // All my data
    var bp = cu.getBasicProfile();
    var name = bp.getName();
    var image = bp.getImageUrl();
    var email = bp.getEmail();

    console.log(name);
    console.log(image);
    console.log(email);
  });
  </script>
</body>

</html>
